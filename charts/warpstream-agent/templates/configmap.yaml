{{- if ne .Values.config.configMapEnabled false }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "warpstream-agent.fullname" . }}
  labels:
    {{- include "warpstream-agent.labels" . | nindent 4 }}
data:
  # The config values below are not required in playground mode.
  {{- if not .Values.config.playground }}
    {{- if or .Values.config.ingestionBucketURL .Values.config.compactionBucketURL}}
      {{- if .Values.config.bucketURL }}
        {{- fail "bucketURL configuration value must not be set when setting ingestionBucketURL" }}
      {{- end }}
      {{- if not .Values.config.compactionBucketURL }}
        {{- fail "compactionBucketURL configuration value must be set when setting ingestionBucketURL" }}
      {{- end }}
      {{- if not .Values.config.ingestionBucketURL }}
        {{- fail "ingestionBucketURL configuration value must be set when setting compactionBucketURL" }}
      {{- end }}
  WARPSTREAM_INGESTION_BUCKET_URL: {{ .Values.config.ingestionBucketURL | quote }}
  WARPSTREAM_COMPACTION_BUCKET_URL: {{ .Values.config.compactionBucketURL | quote }}
    {{- else }}
      {{- if not .Values.config.bucketURL }}
        {{- fail "bucketURL or ingestionBucketURL configuration value must be set" }}
      {{- end }}
  WARPSTREAM_BUCKET_URL: {{ .Values.config.bucketURL | quote }}
      {{- if not .Values.config.virtualClusterID }}
        {{- fail "virtualClusterID configuration value must be set" }}
      {{- end }}
    {{- end }}
  WARPSTREAM_DEFAULT_VIRTUAL_CLUSTER_ID: {{ .Values.config.virtualClusterID | quote }}
    {{- if not .Values.config.region }}
      {{- fail "region configuration value must be set" }}
    {{- end }}
  WARPSTREAM_REGION: {{ .Values.config.region | quote }}
  {{- end }}
{{- end }}