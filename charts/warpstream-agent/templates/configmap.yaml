{{- if ne .Values.config.configMapEnabled false }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "warpstream-agent.fullname" . }}
  labels:
    {{- include "warpstream-agent.labels" . | nindent 4 }}
data:
  # The config values below are not required in playground mode.
  {{- if not .Values.config.playground }}
  {{- if .Values.config.s3ExpressEnabled }}
  {{- if .Values.config.bucketURL }}
    {{- fail "bucketURL configuration should not be set when using s3Express" }}
  {{- end }}
  {{- if not .Values.config.ingestionBucketURL }}
    {{- fail "ingestionBucketURL configuration value must be set" }}
  {{- end }}
  {{- if not .Values.config.compactionBucketURL }}
    {{- fail "compactionBucketURL configuration value must be set" }}
  {{- end }}
  WARPSTREAM_INGESTION_BUCKET_URL: {{ .Values.config.ingestionBucketURL | quote }}
  WARPSTREAM_COMPACTION_BUCKET_URL: {{ .Values.config.compactionBucketURL | quote }}
  {{- else }}
  {{- if .Values.config.ingestionBucketURL }}
    {{- fail "ingestionBucketURL configuration should only be set when using s3Express" }}
  {{- end }}
  {{- if not .Values.config.compactionBucketURL }}
    {{- fail "compactionBucketURL configuration should only be set when using s3Express" }}
  {{- end }}
  {{- if not .Values.config.bucketURL }}
    {{- fail "bucketURL configuration value must be set" }}
  {{- end }}
  WARPSTREAM_BUCKET_URL: {{ .Values.config.bucketURL | quote }}
  {{- end }}
  {{- if not .Values.config.virtualClusterID }}
    {{- fail "virtualClusterID configuration value must be set" }}
  {{- end }}
  WARPSTREAM_DEFAULT_VIRTUAL_CLUSTER_ID: {{ .Values.config.virtualClusterID | quote }}
  {{- if not .Values.config.region }}
    {{- fail "region configuration value must be set" }}
  {{- end }}
  WARPSTREAM_REGION: {{ .Values.config.region | quote }}
  {{- end }}
{{- end }}
